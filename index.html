<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>25ë…„ 5ì›” 24ì¼ ì˜ë‹¨ì–´ í€´ì¦ˆ ê²Œì„</title>
  <style>
    body { font-family: 'Arial', sans-serif; background: #f0f8ff; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    #container { background: #fff; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 360px; padding: 24px; text-align: center; }
    h1 { font-size: 1.5rem; color: #333; }
    label, button { font-size: 1rem; }
    input, select, button { margin: 8px 0; padding: 8px; border-radius: 8px; border: 1px solid #ddd; width: calc(100% - 20px); }
    button { background: #ffb6c1; cursor: pointer; width: auto; }
    .hidden { display: none; }
    .feedback { margin: 12px 0; font-weight: bold; }
    #progress { font-size: 0.9rem; color: #666; margin-bottom: 8px; }
    #scoreboard { font-size: 1.2rem; margin-top: 16px; }
    .blank { font-family: monospace; letter-spacing: 4px; }
  </style>
</head>
<body>
  <div id="container">
    <div id="start-screen">
      <h1>ì˜ë‹¨ì–´ í€´ì¦ˆ</h1>
      <input type="text" id="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" /><br />
      <button id="start-btn">ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="quiz-screen" class="hidden">
      <h1 id="step-title"></h1>
      <div id="progress"></div>
      <div id="question-area"></div>
      <div id="choices-area"></div>
      <button id="next-btn" class="hidden">ë‹¤ìŒ</button>
      <div class="feedback" id="feedback"></div>
    </div>

    <div id="result-screen" class="hidden">
      <h1>ê²°ê³¼</h1>
      <div id="scoreboard"></div>
      <button id="send-btn">ì ìˆ˜ ì „ì†¡</button>
      <div id="response"></div>
    </div>
  </div>

  <script>
    // ì„œë²„ ì „ì†¡ í•¨ìˆ˜
    function saveData(game, name, score, elapsedTime) {
      const FUNCTION_URL = "https://us-central1-record-f420d.cloudfunctions.net/report";
      const requestData = { game, name, score: parseInt(score, 10), elapsedTime: parseInt(elapsedTime, 10) };
      fetch(FUNCTION_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestData) })
      .then(res => res.json().then(data => {
        document.getElementById('response').innerText = res.ok ?
          `ì„±ê³µ: ${JSON.stringify(data, null, 2)}` :
          `ì˜¤ë¥˜: ${JSON.stringify(data, null, 2)}`;
      })).catch(err => {
        document.getElementById('response').innerText = `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}`;
      });
    }

    const quizData = [
      { word: "scream", meaning: "ì†Œë¦¬ ì§€ë¥´ë‹¤" },
      { word: "warm-hearted", meaning: "ë§ˆìŒì´ ë”°ëœ»í•œ" },
      { word: "ridiculous", meaning: "ìš°ìŠ¤ìš´" },
      { word: "sympathy", meaning: "ë™ì •, ê³µê°" },
      { word: "empathize", meaning: "ê³µê°í•˜ë‹¤" },
      { word: "ridicule", meaning: "ë¹„ì›ƒë‹¤" },
      { word: "sympathetic", meaning: "ë™ì •ì‹¬ì´ ìˆëŠ”" },
      { word: "empathy", meaning: "ê°ì •ì´ì…" },
      { word: "decorate", meaning: "ì¥ì‹í•˜ë‹¤" },
      { word: "fiber", meaning: "ì„¬ìœ ì§ˆ" },
      { word: "dietary fiber", meaning: "ì‹ì´ ì„¬ìœ " },
      { word: "contain", meaning: "í¬í•¨í•˜ë‹¤" },
      { word: "instant", meaning: "ì¦‰ê°ì ì¸" },
      { word: "container", meaning: "ìš©ê¸°" },
      { word: "chop", meaning: "ìë¥´ë‹¤" },
      { word: "grind", meaning: "ê°ˆë‹¤" },
      { word: "roast", meaning: "êµ½ë‹¤" },
      { word: "grab", meaning: "ì¡ë‹¤, ì´í•´í•˜ë‹¤" },
      { word: "rotten", meaning: "ì©ì€" },
      { word: "rot", meaning: "ì©ë‹¤" },
      { word: "cuisine", meaning: "ìš”ë¦¬" },
      { word: "raw", meaning: "ë‚ ê²ƒì˜" },
      { word: "grill", meaning: "ì„ì‡ ì— êµ½ë‹¤" },
      { word: "raw material", meaning: "ì›ë£Œ" },
      { word: "edible", meaning: "ë¨¹ì„ ìˆ˜ ìˆëŠ”" },
      { word: "nutrition", meaning: "ì˜ì–‘ë¬¼" },
      { word: "vegetarian", meaning: "ì±„ì‹ì£¼ì˜" },
      { word: "dairy", meaning: "ìœ ì œí’ˆì˜" },
      { word: "kettle", meaning: "ì£¼ì „ì" },
      { word: "tray", meaning: "ìŸë°˜" },
      { word: "seasoning", meaning: "ì¡°ë¯¸ë£Œ, ì–‘ë…" },
      { word: "flavor", meaning: "ë§›, í–¥" },
      { word: "scent", meaning: "í–¥ê¸°" },
      { word: "leftover", meaning: "ë‚¨ì€ ìŒì‹" },
      { word: "swallow", meaning: "ì‚¼í‚¤ë‹¤" },
      { word: "beverage", meaning: "ìŒë£Œ" },
      { word: "squeeze", meaning: "ì§œë‹¤" },
      { word: "ripen", meaning: "ìµë‹¤" },
      { word: "ripe", meaning: "ìµì€" },
      { word: "loose", meaning: "ëŠìŠ¨í•œ" },
      { word: "loosen", meaning: "ëŠìŠ¨í•˜ê²Œ í•˜ë‹¤" },
      { word: "light", meaning: "ê°€ë²¼ìš´, ë°ì€" },
      { word: "lighten", meaning: "ê°€ë³ê²Œ í•˜ë‹¤" },
      { word: "sharp", meaning: "ë‚ ì¹´ë¡œìš´" },
      { word: "sharpen", meaning: "ë‚ ì¹´ë¡­ê²Œ í•˜ë‹¤" },
      { word: "paste", meaning: "ë°˜ì£½" },
      { word: "blend", meaning: "ì„ë‹¤, ì¡°í™”ë˜ë‹¤" },
      { word: "stiff", meaning: "ë»£ë»£í•œ" },
      { word: "impress", meaning: "ì¸ìƒì„ ì£¼ë‹¤" },
      { word: "go well with", meaning: "ì¡°í™”ë˜ë‹¤" }
    ];

    let userName = '', score = 0, currentStep = 0, currentQ = 0, startTime;
    let questions = [];
    const steps = [
      { title: '1ë‹¨ê³„: ëœ» ê³ ë¥´ê¸°', render: renderMC },
      { title: '2ë‹¨ê³„: ë¹ˆì¹¸ ì±„ìš°ê¸° (50%)', render: renderFill.bind(null, 0.5) },
      { title: '3ë‹¨ê³„: ë¹ˆì¹¸ ì±„ìš°ê¸° (100%)', render: renderFill.bind(null, 1) }
    ];

    document.getElementById('start-btn').addEventListener('click', () => {
      const nm = document.getElementById('name').value.trim();
      if (!nm) return alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      userName = nm;
      questions = steps.map(() => shuffle(quizData.slice()));
      score = 0; currentStep = 0; currentQ = 0; startTime = Date.now();
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('quiz-screen').classList.remove('hidden');
      showQuestion();
    });

    document.getElementById('next-btn').addEventListener('click', () => {
      currentQ++;
      if (currentQ < questions[currentStep].length) showQuestion();
      else if (++currentStep < steps.length) { currentQ = 0; showQuestion(); }
      else showResults();
    });

    document.getElementById('send-btn').addEventListener('click', () => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      saveData('ì˜ë‹¨ì–´í€´ì¦ˆ', userName, score, elapsed);
    });

    function showQuestion() {
      document.getElementById('feedback').innerText = '';
      document.getElementById('next-btn').classList.add('hidden');
      document.getElementById('choices-area').style.display = '';
      const { title, render } = steps[currentStep];
      document.getElementById('step-title').innerText = title;
      document.getElementById('progress').innerText = `${currentStep+1}ë‹¨ê³„ ${currentQ+1}/${questions[currentStep].length}ë²ˆ ë¬¸ì œ`;
      render(questions[currentStep][currentQ]);
    }

    function renderMC({ word, meaning }) {
      document.getElementById('question-area').innerHTML = `<div style="font-size:1.25rem; margin-bottom:12px;">${word}</div>`;
      const opts = shuffle([meaning, ...getRandomMeanings(3)]);
      document.getElementById('choices-area').innerHTML = opts.map(o => `<button class="choice">${o}</button>`).join('');
      document.querySelectorAll('.choice').forEach(b => {
        b.onclick = () => {
          if (b.innerText === meaning) { score += 10; document.getElementById('feedback').innerText = 'ì •ë‹µì´ì—ìš”! ğŸ˜Š'; }
          else { document.getElementById('feedback').innerText = `í‹€ë ¸ì–´ìš”. ğŸ˜¢ ëœ»: ${meaning}`; }
          document.getElementById('next-btn').classList.remove('hidden');
        };
      });
    }

    function renderFill(ratio, { word, meaning }) {
      document.getElementById('question-area').innerHTML = `<div style="margin-bottom:12px;">ëœ»: <strong>${meaning}</strong></div>`;
      const chars = word.split('');
      const hideCount = ratio===1? chars.length : Math.floor(chars.length*ratio);
      const hideIdx = shuffle([...Array(chars.length).keys()]).slice(0, hideCount);
      const display = chars.map((c,i) => hideIdx.includes(i)? '_' : c).join('');
      document.getElementById('choices-area').innerHTML = 
        `<div class="blank" style="font-size:1.25rem; margin-bottom:12px;">${display}</div><br>` +
        `<input type="text" id="answer" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" />` +
        `<button id="submit-btn">ì œì¶œ</button>`;
      document.getElementById('submit-btn').onclick = () => {
        const ans = document.getElementById('answer').value.trim().toLowerCase();
        if (ans === questions[currentStep][currentQ].word.toLowerCase()) { score += 10; document.getElementById('feedback').innerText = 'ì •ë‹µì´ì—ìš”! ğŸ˜Š'; }
        else { document.getElementById('feedback').innerText = `í‹€ë ¸ì–´ìš”. ğŸ˜¢ ì •ë‹µ: ${questions[currentStep][currentQ].word}`; }
        document.getElementById('answer').style.display='none';
        document.getElementById('submit-btn').style.display='none';
        document.getElementById('next-btn').classList.remove('hidden');
      };
    }

    function showResults() {
      document.getElementById('quiz-screen').classList.add('hidden');
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      document.getElementById('scoreboard').innerText = `${userName}ë‹˜, ì ìˆ˜: ${score}ì  / ì†Œìš” ì‹œê°„: ${elapsed}ì´ˆ`;
      document.getElementById('result-screen').classList.remove('hidden');
    }

    function shuffle(a) { return a.sort(() => Math.random() - 0.5); }
    function getRandomMeanings(n) { return shuffle(quizData.map(d=>d.meaning)).slice(0,n); }
  </script>
</body>
</html>
